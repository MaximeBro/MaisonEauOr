@page "/signin"
@layout LoginLayout

<PageTitle>Maison eau d'or - Connexion</PageTitle>

<EditForm Model="_model" OnValidSubmit="OnValidSubmit">
    <MudContainer Class="d-flex justify-center align-center" Style="height: 100vh; width: 100vw;" Fixed>
        <MudCard Class="align-self-center rounded-3 mx-auto px-10" Elevation="0">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudStack Row="false">
                        <MudStack Row>
                            <MudImage Fluid Src="/images/logo.png" Width="300"/>
                        </MudStack>
                    </MudStack>
                    <MudText Align="Align.Center" Typo="Typo.h3">Se connecter</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTextField T="string" Class="mb-5" @bind-Value="_model.Username" Label="Identifiant" InputType="InputType.Text" 
                                For="@(() => _model.Username)" Style="max-width: 300px;" Variant="Variant.Outlined"
                                Required RequiredError="Veuillez renseigner votre identifiant" />
                
                 <MudTextField T="string" Class="mb-2" @bind-Value="_model.Password" Label="Mot de passe" InputType="@_passwordFieldType"
                               AdornmentIcon="@_passwordFieldIcon" Adornment="Adornment.End" OnAdornmentClick="ShowPassword"
                                For="@(() => _model.Password)" Style="max-width: 300px;" Variant="Variant.Outlined"
                                Required RequiredError="Veuillez renseigner votre mot de passe" />
            </MudCardContent>
            <MudCardActions Class="flex-column">
                <MudStack Row="false" Justify="Justify.Center" AlignItems="AlignItems.Center">
                    <MudLink Class="mx-auto" Style="text-align: center;" Href="/">Mot de passe oublié ?</MudLink>
                    <MudButton Class="mb-3 py-2 rounded-lg" Style="font-size: 16px; padding-inline: 5rem;" Variant="Variant.Filled" Color="Color.Dark">Connexion</MudButton>
                    <MudStack Row Justify="Justify.Center" AlignItems="AlignItems.Center">
                        <MudDivider Style="border-color: black!important;"/>
                        <MudText Align="Align.Center">Nouveau client ?</MudText>
                        <MudDivider Style="border-color: black!important;"/>
                    </MudStack>
                    <MudButton Class="mb-3 py-2 rounded-lg" Style="padding-inline: 2.5rem;" Variant="Variant.Filled" Color="Color.Dark">S'inscrire</MudButton>
                </MudStack>
            </MudCardActions>
        </MudCard>
    </MudContainer>
</EditForm>

 @code {
    private LoginModel _model = new();

    private InputType _passwordFieldType = InputType.Password;
    private string _passwordFieldIcon = Icons.VisibilityOff;
    private bool _isPasswordShown = false;

    private void ShowPassword()
    {
        if (_isPasswordShown) 
        {
            _isPasswordShown = false;
            _passwordFieldIcon = Icons.VisibilityOff;
            _passwordFieldType = InputType.Password;
        }
        else 
        {
            _isPasswordShown = true;
            _passwordFieldIcon = Icons.Visibility;
            _passwordFieldType = InputType.Text;
        }
        StateHasChanged();
    }

    private void OnValidSubmit()
    {
        // TODO: Fetch DB and check user login form then update its credentials to sessionStorage
    }

    private sealed class LoginModel
    {
        public string Username { get; set; }
        public string Password { get; set; }
    }
}