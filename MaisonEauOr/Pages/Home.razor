@page "/"

@inject IDbContextFactory<MeoDbContext> Factory
@inject AuthenticationStateProvider AuthStateProvider

<PageTitle>Maison eau d'or</PageTitle>

<MudContainer Class="mt-10 px-0" MaxWidth="MaxWidth.ExtraExtraLarge">
    <MudStack Row>
        <MudImage Style="width: 100vw;" Src="images/home/bar.png"/>
    </MudStack>
    <MudText Class="my-8" Style="color: #ECC291!important;" Typo="Typo.h2" Align="Align.Center">Nos meilleures ventes</MudText>
    
    <MudStack Class="mb-16" Row Justify="Justify.SpaceEvenly">
        <MudStack Row="false" Justify="Justify.Center">
            <MudImage Src="images/home/ahlam.png" Height="400"/>
            <MudText Align="Align.Center" Typo="Typo.h6"><b>Ahlam</b></MudText>
            <MudText GutterBottom Align="Align.Center">30,00 €</MudText>
            <MudButton Class="rounded-lg" Variant="Variant.Filled" Color="Color.Dark">Ajouter au panier</MudButton>
        </MudStack>
        <MudStack Row="false" Justify="Justify.Center">
            <MudImage Src="images/home/magic_aisha.png" Height="400"/>
            <MudText Align="Align.Center" Typo="Typo.h6"><b>Magic Aïsha</b></MudText>
            <MudText GutterBottom Align="Align.Center">30,00 €</MudText>
            <MudButton Class="rounded-lg" Variant="Variant.Filled" Color="Color.Dark">Ajouter au panier</MudButton>
        </MudStack>
        <MudStack Row="false" Justify="Justify.Center">
            <MudImage Src="images/home/supreme_flower.png" Height="400"/>
            <MudText Align="Align.Center" Typo="Typo.h6"><b>Pure Evasion</b></MudText>
            <MudText GutterBottom Align="Align.Center">30,00 €</MudText>
            <MudButton Class="rounded-lg" Variant="Variant.Filled" Color="Color.Dark">Ajouter au panier</MudButton>
        </MudStack>
    </MudStack>
    
    <MudText Class="my-8" style="color: #ECC291!important;" Typo="Typo.h2" Align="Align.Center">Découvrez nos produits</MudText>
    
    @* Caroussel catégories (parfums, sprays intérieur, cosmétiques) *@
    <MudCarousel Class="px-16 py-4 mb-16 mud-full-width" Style="height: 520px; background-color: #F7E1C7;" ShowArrows ShowBullets="false" EnableSwipeGesture TData="object">
        <MudCarouselItem Transition="Transition.Slide">
            <MudStack Row Justify="Justify.SpaceEvenly">
                <MudStack Row="false" Style="height: 100%;">
                    <MudImage Class="flex-grow-1" Src="images/home/parfums.png" Height="520"/>
                    <MudText Class="absolute align-self-center" Style="bottom: 15px; color: #fff;" Align="Align.Center" Typo="Typo.h3">PARFUMS</MudText>
                </MudStack>
                <MudStack Row="false" Style="height: 100%;">
                    <MudImage Class="flex-grow-1" Src="images/home/sprays_interieur.png" Height="520"/>
                    <MudText Class="absolute align-self-center" Style="bottom: 15px; color: #fff;" Align="Align.Center" Typo="Typo.h3">SPRAYS<br/>INTÉRIEUR</MudText>
                </MudStack>
                <MudStack Row="false" Style="height: 100%;">
                    <MudImage Class="flex-grow-1" Src="images/home/cosmetiques.png" Height="520"/>
                    <MudText Class="absolute align-self-center" Style="bottom: 15px; color: #fff;" Align="Align.Center" Typo="Typo.h3">COSMÉTIQUES</MudText>
                </MudStack>
            </MudStack>
        </MudCarouselItem>
        <MudCarouselItem Transition="Transition.Slide">
            <MudStack Row Justify="Justify.SpaceEvenly">
                <MudStack Row="false" Style="height: 100%;">
                    <MudImage Class="flex-grow-1" Src="images/home/musc_tahara_intime.png" Height="520"/>
                    <MudText Class="absolute align-self-center" Style="bottom: 15px; color: #fff;" Align="Align.Center" Typo="Typo.h3">MUSC TAHARA<br/>INTIME</MudText>
                </MudStack>
                <MudStack Row="false" Style="height: 100%;">
                    <MudImage Class="flex-grow-1" Src="images/home/ahlam.png" Height="520"/>
                    <MudText Class="absolute align-self-center" Style="bottom: 15px; color: #fff;" Align="Align.Center" Typo="Typo.h3">PARFUMS</MudText>
                </MudStack>
                <MudStack Row="false" Style="height: 100%;">
                    <MudImage Class="flex-grow-1" Src="images/home/cosmetiques.png" Height="520"/>
                    <MudText Class="absolute align-self-center" Style="bottom: 15px; color: #fff;" Align="Align.Center" Typo="Typo.h3">COSMÉTIQUES</MudText>
                </MudStack>
            </MudStack>
        </MudCarouselItem>
    </MudCarousel>
    
    @* Description boutique avec photo réduite bar à parfum *@
    <MudPaper Class="px-10 my-16" Elevation="0" Square Style="background-color: #F7E1C7;">
        <MudStack Class="py-8" Row>
            <MudStack Class="mr-8 px-10 py-6" Row="false" Style="background-color: #fff;" Justify="Justify.Center">
                <MudText Typo="Typo.h5" Align="Align.Center"><b>Le Bar à parfum</b></MudText>
                <MudImage Class="mx-auto my-n6" Src="favicon.png" Width="200" />
                <MudText Align="Align.Center">Bienvenue dans notre bar à parfum</MudText>
                <MudText Align="Align.Center">Découvrez le concept original de maison eau d'or situé au 123 Avenue René Coté au Havre</MudText>
                <MudText Align="Align.Center">Nous proposons des collections uniques de parfums et de sprays d'intérieur</MudText>
                <MudSpacer />
                <MudButton Class="rounded-lg mx-auto mb-8" Style="background-color: #F7E1C7; color: #916043;" EndIcon="@Icons.KeyboardArrowRight" Variant="Variant.Filled">Découvrir</MudButton>
            </MudStack>
            <MudStack Class="flex-grow-1" Style="max-width: 1400px;">
                <MudImage Src="images/home/bar.png" Style="width: 100%; height: auto;"/>
            </MudStack>
        </MudStack>
    </MudPaper>
</MudContainer>


@code {
    private MeoDbContext _context = null!;

    protected override async Task OnInitializedAsync()
    {
        _context = await Factory.CreateDbContextAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var authService = (AuthenticationService)AuthStateProvider;
            var userSession = await authService.GetCurrentUserAsync();
            if (userSession is null)
            {
                await authService.UpdateAuthenticationState(null);
            }
            if (_context.UserAccounts.All(x => x.Email != "root@admin.meo"))
            {
                _context = await Factory.CreateDbContextAsync();
                _context.UserAccounts.Add(new UserAccount
                {
                    Firstname = "admin",
                    Lastname = "meo",
                    Email = "root@admin.meo",
                    Password = BC.HashPassword("toor"),
                    Role = UserRole.Admin,
                    DoubleAuth = false
                });
                await _context.SaveChangesAsync();
            }
        }
    }

}