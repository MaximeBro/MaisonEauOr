@page "/catalogPerfume"
@using MaisonEauOr.Models

@inject IDbContextFactory<MeoDbContext> Factory

<PageTitle>Maison eau d'or - Parfums</PageTitle>

<MudStack Class="mt-10" Row>
    <MudSpacer />
    <MudSelect T="string" @bind-Value="_selectedFilter" Style="max-width: 350px;" Variant="Variant.Filled" Adornment="Adornment.Start" AdornmentIcon="@Icons.FilterAlt" Label="Filtrer" AnchorOrigin="Origin.BottomCenter" >
        <MudSelectItem T="string" Value="@("Tous")">Tous</MudSelectItem>
        <MudSelectItem T="string" Value="@("A-Z")">A-Z</MudSelectItem>
        <MudSelectItem T="string" Value="@("Z-A")">Z-A</MudSelectItem>
        <MudSelectItem T="string" Value="@("Prix croissant")">Prix croissant</MudSelectItem>
        <MudSelectItem T="string" Value="@("Prix décroissant")">Prix décroissant</MudSelectItem>
</MudSelect>

</MudStack>

<MudGrid Class="px-6" Spacing="5" Justify="Justify.Center">
    @foreach (ProductModel perfume in perfumeList)
    {
        <MudItem Class="mt-5" Style="width:20%!important;" xs="12" sm="6" md="4" lg="3">
            <MudCard>
                <MudImage Src="@perfume.ImagePath" Alt="@perfume.Name" />
                <MudCardContent>
                    <MudText Align="Align.Center" Typo="Typo.h5"><b>@perfume.Name</b></MudText>
                    <MudText Align="Align.Center" Typo="Typo.body2">@perfume.Price</MudText>
                </MudCardContent>
                <MudCardActions Class="justify-center">
                        <MudButton Variant="Variant.Filled" Color="Color.Surface">Ajouter au panier</MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    }
</MudGrid>

    @code {
    private List<ProductModel> perfumeList = new List<ProductModel>();
    private string _selectedFilter = "Tous";

    protected override async Task OnInitializedAsync()
    {
        _context = await Factory.CreateDbContextAsync();
        perfumeList = _context.Products.Where(x => x.Category == ProductCategory.Perfume && x.IsAvailable).ToList();
        foreach (var product in perfumeList)
        {
            product.Options = _context.Options.Where(x => x.ProductID == product.Id).ToList();
        }
    }
    private MeoDbContext _context = null!;
}
